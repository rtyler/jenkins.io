<!DOCTYPE html>
<html>
<head>
<title>
Shared Libraries
</title>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
<meta content="Jenkins is an open source automation server" name="description">
<link href="/sites/default/files/jenkins_favicon.ico" rel="shortcut icon" type="image/x-icon">
<!-- starting partial scriptlinks.html.haml -->
<link href="https://rtyler.github.io/jenkins.io/css/font-awesome.min.css" media="screen" rel="stylesheet">
<link href="https://rtyler.github.io/jenkins.io/assets/bower/bootstrap/css/bootstrap.min.css" media="screen" rel="stylesheet">
<link href="https://rtyler.github.io/jenkins.io/assets/bower/ekko-lightbox/ekko-lightbox.min.css" media="screen" rel="stylesheet">
<link href="https://rtyler.github.io/jenkins.io/assets/bower/tether/css/tether.min.css" media="screen" rel="stylesheet">
<link href="https://rtyler.github.io/jenkins.io/css/font-icons.css" media="screen" rel="stylesheet">
<link href="https://rtyler.github.io/jenkins.io/css/jenkins.css" media="screen" rel="stylesheet">
<script src="https://rtyler.github.io/jenkins.io/assets/bower/jquery/jquery.min.js"></script>
<script src="https://rtyler.github.io/jenkins.io/assets/bower/tether/js/tether.min.js"></script>
<script src="https://rtyler.github.io/jenkins.io/assets/bower/bootstrap/js/bootstrap.min.js"></script>
<script src="https://rtyler.github.io/jenkins.io/assets/bower/ekko-lightbox/ekko-lightbox.min.js"></script>

<!-- ending partial scriptlinks.html.haml -->
</head>
<body>
<!-- starting partial toptoolbar.html.haml -->
<script>
  $(function () {
    $(document).delegate('*[data-toggle="lightbox"]', 'click', function(event) {
      event.preventDefault();
      $(this).ekkoLightbox();
    });
  })
</script>
<div id="ji-hover-layer"></div>
<div class="ji-toolbar-offset"></div>
<div class="fixed top">
<nav class="navbar navbar-dark bg-inverse" id="ji-toolbar">
<a class="fixed navbar-brand" href="https://rtyler.github.io/jenkins.io" id="home-logo">
Jenkins
</a>
<ul class="nav navbar-nav">
<li class="nav-item fixed">
<div class="btn-group" id="download-menu">
<a aria-expanded="false" aria-haspopup="true" class="btn btn-primary dropdown-toggle" data-toggle="dropdown">
Downloads
</a>
<!-- starting partial downloadlist.html.haml -->
<div class="dropdown-menu">
<div class="row">
<div class="col-md-6 text-xs-center">
<h3>
LTS Release
</h3>
<p>
LTS (Long-Term Support) releases are chosen every 12 weeks from the
stream of regular releases as the stable release for that time period.
</p>
</div>
<div class="col-md-6 text-xs-center">
<h3>
Weekly Release
</h3>
<p>
A new release is produced weekly to deliver bug fixes and features to
users and plugin developers.
</p>
</div>
</div>
<div class="row">
<div class="col-md-6 text-xs-center">
<div class="btn-group">
<a class="btn btn-primary chromeOnly" href="http://mirrors.jenkins.io/war-stable/latest/jenkins.war">
<i class="icon-box-add"></i>
2.19.4
.war
</a>
<button aria-expanded="false" aria-haspopup="true" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" data-trigger="hover"></button>
<div class="dropdown-menu">
<a class="dropdown-item" href="https://registry.hub.docker.com/u/jenkinsci/jenkins/">
<span class="icon"></span>
<span class="title">
Docker
</span>
</a>
<a class="dropdown-item" href="http://www.freshports.org/devel/jenkins-lts">
<span class="icon"></span>
<span class="title">
FreeBSD
</span>
</a>
<a class="dropdown-item" href="https://packages.gentoo.org/packages/dev-util/jenkins-bin">
<span class="icon"></span>
<span class="title">
Gentoo
</span>
</a>
<a class="dropdown-item" href="/content/thank-you-downloading-os-x-installer#stable">
<span class="icon"></span>
<span class="title">
Mac OS X
</span>
</a>
<a class="dropdown-item" href="http://openports.se/devel/jenkins/stable">
<span class="icon"></span>
<span class="title">
OpenBSD
</span>
</a>
<a class="dropdown-item" href="https://pkg.jenkins.io/opensuse-stable/">
<span class="icon"></span>
<span class="title">
openSUSE
</span>
</a>
<a class="dropdown-item" href="https://pkg.jenkins.io/redhat-stable/">
<span class="icon"></span>
<span class="title">
Red Hat/Fedora/CentOS
</span>
</a>
<a class="dropdown-item" href="https://pkg.jenkins.io/debian-stable/">
<span class="icon"></span>
<span class="title">
Ubuntu/Debian
</span>
</a>
<a class="dropdown-item" href="/content/thank-you-downloading-windows-installer#stable">
<span class="icon"></span>
<span class="title">
Windows
</span>
</a>
</div>
</div>
<p class="details">
<a class="item" href="/changelog-stable">Changelog</a>
|
<a class="item" href="/doc/upgrade-guide">Upgrade Guide</a>
|
<a class="item" href="http://mirrors.jenkins.io/war-stable/">Past Releases</a>
</p>
</div>
<div class="col-md-6 text-xs-center">
<div class="btn-group">
<a class="btn btn-primary chromeOnly" href="http://mirrors.jenkins.io/war/latest/jenkins.war">
<i class="icon-box-add"></i>
2.34
.war
</a>
<button aria-expanded="false" aria-haspopup="true" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" data-trigger="hover"></button>
<div class="dropdown-menu">
<a class="dropdown-item" href="https://registry.hub.docker.com/u/jenkinsci/jenkins/">
<span class="icon"></span>
<span class="title">
Docker
</span>
</a>
<a class="dropdown-item" href="http://www.freshports.org/devel/jenkins">
<span class="icon"></span>
<span class="title">
FreeBSD
</span>
</a>
<a class="dropdown-item" href="https://packages.gentoo.org/packages/dev-util/jenkins-bin">
<span class="icon"></span>
<span class="title">
Gentoo
</span>
</a>
<a class="dropdown-item" href="/content/thank-you-downloading-os-x-installer">
<span class="icon"></span>
<span class="title">
Mac OS X
</span>
</a>
<a class="dropdown-item" href="http://openports.se/devel/jenkins/devel">
<span class="icon"></span>
<span class="title">
OpenBSD
</span>
</a>
<a class="dropdown-item" href="https://pkg.jenkins.io/opensuse/">
<span class="icon"></span>
<span class="title">
openSUSE
</span>
</a>
<a class="dropdown-item" href="https://pkg.jenkins.io/redhat/">
<span class="icon"></span>
<span class="title">
Red Hat/Fedora/CentOS
</span>
</a>
<a class="dropdown-item" href="https://pkg.jenkins.io/debian/">
<span class="icon"></span>
<span class="title">
Ubuntu/Debian
</span>
</a>
<a class="dropdown-item" href="/content/thank-you-downloading-windows-installer">
<span class="icon"></span>
<span class="title">
Windows
</span>
</a>
</div>
</div>
<p class="details">
<a class="item" href="/changelog">Changelog</a>
|
<a class="item" href="http://mirrors.jenkins.io/war/">Past Releases</a>
</p>
</div>
</div>
</div>

<!-- ending partial downloadlist.html.haml -->
</div>
</li>
<li class="nav-item">
<a class="nav-link" href="https://rtyler.github.io/jenkins.io/node">
Blog
</a>
</li>
<li class="nav-item">
<a class="nav-link" href="https://rtyler.github.io/jenkins.io/doc">
Documentation
</a>
</li>
<li class="nav-item">
<a class="nav-link" href="https://plugins.jenkins.io/">
Plugins
</a>
</li>
<li class="nav-item dropdown">
<a aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button">
Use-cases
</a>
<div class="dropdown-menu">
<a class="dropdown-item feature" href="https://rtyler.github.io/jenkins.io/solutions/android">
Android
</a>
<a class="dropdown-item feature" href="https://rtyler.github.io/jenkins.io/solutions/c">
C/C++
</a>
<a class="dropdown-item feature" href="https://rtyler.github.io/jenkins.io/solutions/docker">
Docker
</a>
<a class="dropdown-item feature" href="https://rtyler.github.io/jenkins.io/solutions/embedded">
Embedded
</a>
<a class="dropdown-item feature" href="https://rtyler.github.io/jenkins.io/solutions/github">
GitHub
</a>
<a class="dropdown-item feature" href="https://rtyler.github.io/jenkins.io/solutions/java">
Java
</a>
<a class="dropdown-item feature" href="https://rtyler.github.io/jenkins.io/solutions/pipeline">
Continuous Delivery
</a>
<a class="dropdown-item feature" href="https://rtyler.github.io/jenkins.io/solutions/python">
Python
</a>
<a class="dropdown-item feature" href="https://rtyler.github.io/jenkins.io/solutions/ruby">
Ruby
</a>
</div>
</li>
<li class="nav-item dropdown">
<a aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button">
Participate
</a>
<div class="dropdown-menu">
<a class="dropdown-item" href="https://rtyler.github.io/jenkins.io/content/mailing-lists" title="Browse Jenkins mailing list archives and/or subscribe to lists">
Mailing Lists
</a>
<a class="dropdown-item" href="https://rtyler.github.io/jenkins.io/content/chat" title="Chat with the rest of the Jenkins community on IRC">
Chat
</a>
<a class="dropdown-item" href="https://twitter.com/jenkinsci" title="Check out @jenkinsci on Twitter">
Twitter
</a>
<a class="dropdown-item" href="https://rtyler.github.io/jenkins.io/content/event-calendar" title="Calendar for Jenkins events">
Events
</a>
<a class="dropdown-item" href="https://wiki.jenkins-ci.org/display/JENKINS/Office+Hours" title="Hangouts-based online meeting">
Office Hours
</a>
<a class="dropdown-item" href="https://reddit.com/r/jenkinsci" title="Latest Jenkins related news on /r/jenkinsci">
/r/jenkinsci
</a>
</div>
</li>
<li class="nav-item dropdown">
<a aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-toggle="dropdown" href="/projects" role="button">
Sub-projects
</a>
<div class="dropdown-menu">
<a class="dropdown-item feature" href="https://rtyler.github.io/jenkins.io/projects/">
Overview
</a>
<a class="dropdown-item feature" href="/projects/blueocean/">
Blue Ocean
</a>
<a class="dropdown-item feature" href="/projects/gsoc/">
Google Summer of Code
</a>
<a class="dropdown-item feature" href="/projects/infrastructure/">
Infrastructure
</a>
<a class="dropdown-item feature" href="/projects/jam/">
Jenkins Area Meetups
</a>
</div>
</li>
<li class="nav-item dropdown">
<a aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button">
Resources
</a>
<div class="dropdown-menu">
<a class="dropdown-item feature" href="https://accounts.jenkins.io/" title="Create/manage your account for accessing wiki, issue tracker, etc">
Account Management
</a>
<a class="dropdown-item feature" href="https://issues.jenkins-ci.org/">
Issue Tracker
</a>
<a class="dropdown-item feature" href="https://wiki.jenkins-ci.org/">
Wiki
</a>
</div>
</li>
<li class="nav-item">
<a class="nav-link" href="https://rtyler.github.io/jenkins.io/security">
Security
</a>
</li>
<li class="nav-item">
<a class="nav-link" href="https://rtyler.github.io/jenkins.io/press">
Press
</a>
</li>
<li class="nav-item">
<a class="nav-link" href="https://rtyler.github.io/jenkins.io/conduct">
Conduct
</a>
</li>
</ul>
</nav>
</div>
<div id="ji-top-peg">
<a href="https://github.com/jenkinsci" id="ji-fork-tag">
<img alt="Fork us on GitHub" src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png" style="position: absolute; top: 0; right: 0; border: 0;">
</a>
</div>

<!-- ending partial toptoolbar.html.haml -->
<div class="container">
<div class="row body">
<div class="section_nav pagination-links">
<a class="prev page-link" href="../multibranch">
⇐ Multibranch Pipelines
</a>
<a class="up page-link" href="../">
⇑ "Pipeline
</a>
<br>
<a class="index page-link" href="../../">
Index
</a>
</div>
<div class="section">
<h1>
Shared Libraries
</h1>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#defining-shared-libraries">Defining Shared Libraries</a>
<ul class="sectlevel2">
<li><a href="#directory-structure">Directory structure</a></li>
<li><a href="#global-shared-libraries">Global Shared Libraries</a></li>
<li><a href="#folder-level-shared-libraries">Folder-level Shared Libraries</a></li>
<li><a href="#automatic-shared-libraries">Automatic Shared Libraries</a></li>
</ul>
</li>
<li><a href="#using-libraries">Using libraries</a>
<ul class="sectlevel2">
<li><a href="#overriding-versions">Overriding versions</a></li>
</ul>
</li>
<li><a href="#writing-libraries">Writing libraries</a>
<ul class="sectlevel2">
<li><a href="#accessing-steps">Accessing steps</a></li>
<li><a href="#defining-steps">Defining steps</a></li>
<li><a href="#defining-global-variables">Defining global variables</a></li>
<li><a href="#defining-a-more-structured-dsl">Defining a more structured DSL</a></li>
<li><a href="#using-third-party-libraries">Using third-party libraries</a></li>
<li><a href="#loading-resources">Loading resources</a></li>
<li><a href="#pretesting-library-changes">Pretesting library changes</a></li>
</ul>
</li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>As Pipeline is adopted for more and more projects in an organization, common
patterns are likely to emerge. Oftentimes it is useful to share parts of
Pipeline scripts between various projects to reduce redundancies and keep code
"DRY"
<sup class="footnote" id="_footnote_dry">[<a id="_footnoteref_1" class="footnote" href="#_footnote_1" title="View footnote.">1</a>]</sup>.</p>
</div>
<div class="paragraph">
<p>Pipeline has support for creating "Shared Libraries" which can be defined in
external source control repositories and loaded into existing Pipelines.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="defining-shared-libraries"><a class="anchor" href="#defining-shared-libraries"></a>Defining Shared Libraries</h2>
<div class="sectionbody">
<div class="paragraph">
<p>An Shared Library is defined with a name, a source code retrieval method such
as by SCM, and optionally a default version.  The name should be a short
identifier as it will be used in scripts.</p>
</div>
<div class="paragraph">
<p>The version could be anything understood by that SCM; for example, branches,
tags, and commit hashes all work for Git.  You may also declare whether scripts
need to explicitly request that library (detailed below), or if it is present
by default.  Furthermore, if you specify a version in Jenkins configuration,
you can block scripts from selecting a <em>different</em> version.</p>
</div>
<div class="paragraph">
<p>The best way to specify the SCM is using an SCM plugin which has been
specifically updated to support a new API for checking out an arbitrary named
version (<em>Modern SCM</em> option).  As of this writing, the latest versions of the
Git and Subversion plugins support this mode; others should follow.</p>
</div>
<div class="paragraph">
<p>If your SCM plugin has not been integrated, you may select <em>Legacy SCM</em> and
pick anything offered.  In this case, you need to include
<code>${library.yourLibName.version}</code> somewhere in the configuration of the SCM, so
that during checkout the plugin will expand this variable to select the desired
version.  For example, for Subversion, you can set the <em>Repository URL</em> to
<code>https://svnserver/project/${library.yourLibName.version}</code> and then use
versions such as <code>trunk</code> or <code>branches/dev</code> or <code>tags/1.0</code>.</p>
</div>
<div class="sect2">
<h3 id="directory-structure"><a class="anchor" href="#directory-structure"></a>Directory structure</h3>
<div class="paragraph">
<p>The directory structure of a Shared Library repository is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>(root)
+- src                     # Groovy source files
|   +- org
|       +- foo
|           +- Bar.groovy  # for org.foo.Bar class
+- vars
|   +- foo.groovy          # for global 'foo' variable/function
|   +- foo.txt             # help for 'foo' variable/function
+- resources               # resource files (external libraries only)
|   +- org
|       +- foo
|           +- bar.json    # static helper data for org.foo.Bar</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>src</code> directory should look like standard Java source directory structure.
This directory is added to the classpath when executing Pipelines.</p>
</div>
<div class="paragraph">
<p>The <code>vars</code> directory hosts scripts that define global variables accessible from
Pipeline scripts.
The basename of each <code>*.groovy</code> file should be a Groovy (~ Java) identifier, conventionally <code>camelCased</code>.
The matching <code>*.txt</code>, if present, can contain documentation, processed through the system’s configured markup formatter
(so may really be HTML, Markdown, etc., though the <code>txt</code> extension is required).</p>
</div>
<div class="paragraph">
<p>The Groovy source files in these directories get the same “CPS transformation” as your Pipeline scripts.</p>
</div>
<div class="paragraph">
<p>A <code>resources</code> directory allows the <code>libraryResource</code> step to be used from an external library to load associated non-Groovy files.
Currently this feature is not supported for internal libraries.</p>
</div>
<div class="paragraph">
<p>Other directories under the root are reserved for future enhancements.</p>
</div>
</div>
<div class="sect2">
<h3 id="global-shared-libraries"><a class="anchor" href="#global-shared-libraries"></a>Global Shared Libraries</h3>
<div class="paragraph">
<p>There are several places where Shared Libraries can be defined, depending on
the use-case. <em>Manage Jenkins » Configure System » Global Pipeline Libraries</em>
as many libraries as necessary can be configured.</p>
</div>
<div class="paragraph">
<p>Since these libraries will be globally usable, any Pipeline in the system can
utilize functionality implemented in these libraries.</p>
</div>
<div class="paragraph">
<p>These libraries are considered "trusted:" they can run any methods in Java,
Groovy, Jenkins internal APIs, Jenkins plugins, or third-party libraries.  This
allows you to define libraries which encapsulate individually unsafe APIs in a
higher-level wrapper safe for use from any job.  Beware that <strong>anyone able to
push commits to this SCM repository could obtain unlimited access to Jenkins</strong>.
You need the <em>Overall/RunScripts</em> permission to configure these libraries
(normally this will be granted to Jenkins administrators).</p>
</div>
</div>
<div class="sect2">
<h3 id="folder-level-shared-libraries"><a class="anchor" href="#folder-level-shared-libraries"></a>Folder-level Shared Libraries</h3>
<div class="paragraph">
<p>Any Folder created can have Shared Libraries associated with it. This mechanism
allows scoping of specific libraries to all the Pipelines inside of the folder
or subfolder.</p>
</div>
<div class="paragraph">
<p>Folder-based libraries are not considered "trusted:" they run in the Groovy
sandbox just like typical Pipeline scripts.</p>
</div>
</div>
<div class="sect2">
<h3 id="automatic-shared-libraries"><a class="anchor" href="#automatic-shared-libraries"></a>Automatic Shared Libraries</h3>
<div class="paragraph">
<p>Other plugins may add ways of defining libraries on the fly.
For example, the
<a href="https://plugins.jenkins.io/github-organization-folder">GitHub Organization Folder</a>
plugin allows a scripty to use an untrusted library such as
<code>github.com/someorg/somerepo</code> without any additional configuration.  In this
case, the specified GitHub repository would be loaded, from the <code>master</code>
branch, using an anonymous checkout.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using-libraries"><a class="anchor" href="#using-libraries"></a>Using libraries</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Pipeline scripts can access shared libraries marked <em>Load implicitly</em>, They may
immediately use classes or global variables defined by any such libraries
(details below).</p>
</div>
<div class="paragraph">
<p>To access other shared libraries, a script needs to use the <code>@Library</code>
annotation, specifying the library&#8217;s name:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="groovy"><span style="color:#007">@Library</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">somelib</span><span style="color:#710">'</span></span>)
<span style="color:#777">/* Using a version specifier, such as branch, tag, etc */</span>
<span style="color:#007">@Library</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">somelib@1.0</span><span style="color:#710">'</span></span>)
<span style="color:#777">/* Accessing multiple libraries with one statement */</span>
<span style="color:#007">@Library</span>([<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">somelib</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">otherlib@abc1234</span><span style="color:#710">'</span></span>])</code></pre>
</div>
</div>
<div class="paragraph">
<p>The annotation can be anywhere in the script where an annotation is permitted
by Groovy.  When referring to class libraries (with <code>src/</code> directories),
conventionally the annotation goes on an <code>import</code> statement:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="groovy"><span style="color:#007">@Library</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">somelib</span><span style="color:#710">'</span></span>)
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">com.mycorp.pipeline.somelib.UsefulClass</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It is legal, though unnecessary, to <code>import</code> a global variable (or function)
defined in the <code>vars/</code> directory:</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note that libraries are resolved and loaded during <em>compilation</em> of the script,
before it starts executing.  This allows the Groovy compiler to understand the
meaning of symbols used in static type checking, and permits them to be used
in type declarations in the script, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="groovy"><span style="color:#007">@Library</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">somelib</span><span style="color:#710">'</span></span>)
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">com.mycorp.pipeline.somelib.Helper</span>

<span style="color:#339;font-weight:bold">int</span> useSomeLib(Helper helper) {
    helper.prepare()
    <span style="color:#080;font-weight:bold">return</span> helper.count()
}

echo useSomeLib(<span style="color:#080;font-weight:bold">new</span> Helper(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">some text</span><span style="color:#710">'</span></span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p>Global Variables/functions however, are resolved at runtime.</p>
</div>
<div class="sect2">
<h3 id="overriding-versions"><a class="anchor" href="#overriding-versions"></a>Overriding versions</h3>
<div class="paragraph">
<p>A <code>@Library</code> annotation may override a default version given in the library’s
definition, if the definition permits this.  In particular, a shared library
marked for implicit use can still be loaded in a different version using the
annotation (unless the definition specifically forbids this).</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="writing-libraries"><a class="anchor" href="#writing-libraries"></a>Writing libraries</h2>
<div class="sectionbody">
<div class="paragraph">
<p>At the base level, any valid
<a href="http://groovy-lang.org/syntax.html">Groovy code</a>
is okay for use. Different data structures, utility functions, etc, such as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="groovy"><span style="color:#777">// src/org/foo/Point.groovy</span>
<span style="color:#080;font-weight:bold">package</span> org.foo;

<span style="color:#777">// point in 3D space</span>
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Point</span> {
  <span style="color:#339;font-weight:bold">float</span> x,y,z;
}</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="accessing-steps"><a class="anchor" href="#accessing-steps"></a>Accessing steps</h3>
<div class="paragraph">
<p>Library classes cannot directly call step functions such as <code>sh</code> or <code>git</code>.
They can however implement functions, outside of the scope of an enclosing
class, which in turn invoke Pipeline steps, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="groovy"><span style="color:#777">// src/org/foo/Zot.groovy</span>
<span style="color:#080;font-weight:bold">package</span> org.foo;

<span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">checkOutFrom</span>(repo) {
  git <span style="color:#606">url</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">git@github.com:jenkinsci/</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">${</span>repo<span style="font-weight:bold;color:#666">}</span></span><span style="color:#710">&quot;</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Which can then be called from a Pipeline Script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> z = <span style="color:#080;font-weight:bold">new</span> org.foo.Zot()
z.checkOutFrom(repo)</code></pre>
</div>
</div>
<div class="paragraph">
<p>This approach has limitations; for example, it prevents the declaration of a
superclass.</p>
</div>
<div class="paragraph">
<p>Alternately, a set of <code>steps</code> can be passed explicitly to a library class, in a
constructor, or just one method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="groovy"><span style="color:#080;font-weight:bold">package</span> org.foo
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Utilities</span> {
  <span style="color:#080;font-weight:bold">def</span> steps
  <span style="color:#0a8;font-weight:bold">Utilities</span>(steps) {<span style="color:#950">this</span>.steps = steps}
  <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">mvn</span>(args) {
    steps.sh <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">${</span>steps.tool <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Maven</span><span style="color:#710">'</span></span><span style="font-weight:bold;color:#666">}</span></span><span style="color:#D20">/bin/mvn -o </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">${</span>args<span style="font-weight:bold;color:#666">}</span></span><span style="color:#710">&quot;</span></span>
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Which would be access from Pipeline with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="groovy"><span style="color:#007">@Library</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">utils</span><span style="color:#710">'</span></span>) <span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.foo.Utilities</span>
<span style="color:#080;font-weight:bold">def</span> utils = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Utilities</span>(steps)
node {
  utils.mvn <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">clean package</span><span style="color:#710">'</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the library needs to access global variables, such as <code>env</code>, those should be
explicitly passed into the library classes, or functions, in a similar manner.</p>
</div>
<div class="paragraph">
<p>Instead of passing numerous variables from the Pipeline Script into a library,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="groovy"><span style="color:#080;font-weight:bold">package</span> org.foo
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Utilities</span> {
  <span style="color:#088;font-weight:bold">static</span> <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">mvn</span>(script, args) {
    script.sh <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">${</span>script.tool <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Maven</span><span style="color:#710">'</span></span><span style="font-weight:bold;color:#666">}</span></span><span style="color:#D20">/bin/mvn -s </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">${</span>script.env.HOME<span style="font-weight:bold;color:#666">}</span></span><span style="color:#D20">/jenkins.xml -o </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">${</span>args<span style="font-weight:bold;color:#666">}</span></span><span style="color:#710">&quot;</span></span>
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example shows the script being passed in to one <code>static</code> method,
invoked from a Pipeline Script as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="groovy"><span style="color:#007">@Library</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">utils</span><span style="color:#710">'</span></span>) <span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">static</span> <span style="color:#B44;font-weight:bold">org.foo.Utilities.*</span>
node {
  mvn <span style="color:#950">this</span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">clean package</span><span style="color:#710">'</span></span>
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="defining-steps"><a class="anchor" href="#defining-steps"></a>Defining steps</h3>
<div class="paragraph">
<p>Shared Libraries can also define functions which look and feel like built-in
steps, such as <code>sh</code> or <code>git</code>.</p>
</div>
<div class="paragraph">
<p>For example, to define <code>helloWorld</code> step, the file <code>vars/helloWorld.groovy</code>
should be created and have a <code>call</code> method defined:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="groovy"><span style="color:#777">// vars/helloWorld.groovy</span>
<span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">call</span>(name) {
    <span style="color:#777">// you can call any valid step functions from your code, just like you can from Pipeline scripts</span>
    echo <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Hello world, </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">${</span>name<span style="font-weight:bold;color:#666">}</span></span><span style="color:#710">&quot;</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Pipeline Script would then be able to call this step:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="groovy">helloWorld <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Joe</span><span style="color:#710">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If called with a block, the <code>call</code> method will receive a
<a href="http://groovy-lang.org/closures.html"><code>Closure</code></a>.
The type should be defined explicitly to clarify the intent of the step, for
example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="groovy"><span style="color:#777">// vars/windows.groovy</span>
<span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">call</span>(Closure body) {
    node(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">windows</span><span style="color:#710">'</span></span>) {
        body()
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Pipeline Script can then use this like any other step which accepts a
block:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="groovy">windows {
    bat <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">cmd /?</span><span style="color:#710">&quot;</span></span>
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="defining-global-variables"><a class="anchor" href="#defining-global-variables"></a>Defining global variables</h3>
<div class="paragraph">
<p>Internally, scripts in the <code>vars</code> directory are instantiated as a singleton
on-demand, when used first.  So it is possible to define more methods,
properties on a single file that interact with each other:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="groovy"><span style="color:#777">// vars/acme.groovy</span>
<span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">setFoo</span>(v) {
    <span style="color:#950">this</span>.foo = v;
}
<span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">getFoo</span>() {
    <span style="color:#080;font-weight:bold">return</span> <span style="color:#950">this</span>.foo;
}
<span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">say</span>(name) {
    echo <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Hello world, </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">${</span>name<span style="font-weight:bold;color:#666">}</span></span><span style="color:#710">&quot;</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then the Pipeline Script can invoke these functions, rooted off the <code>acme</code>
object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="groovy">acme.foo = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">5</span><span style="color:#710">&quot;</span></span>;
echo acme.foo; <span style="color:#777">// print 5</span>
acme.say <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Joe</span><span style="color:#710">&quot;</span></span> <span style="color:#777">// print &quot;Hello world, Joe&quot;</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>A variable defined in a shared library will only show up in <em>Global Variables
Reference</em> (under <em>Pipeline Syntax</em>) after you have first run a successful
build using that library, allowing its sources to be checked out by Jenkins.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="defining-a-more-structured-dsl"><a class="anchor" href="#defining-a-more-structured-dsl"></a>Defining a more structured DSL</h3>
<div class="paragraph">
<p>If you have a lot of Pipeline jobs that are mostly similar, the global
function/variable mechanism gives you a handy tool to build a higher-level DSL
that captures the similarity. For example, all Jenkins plugins are built and
tested in the same way, so we might write a step named
<code>jenkinsPlugin</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="groovy"><span style="color:#777">// vars/jenkinsPlugin.groovy</span>
<span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">call</span>(body) {
    <span style="color:#777">// evaluate the body block, and collect configuration into the object</span>
    <span style="color:#080;font-weight:bold">def</span> config = [:]
    body.resolveStrategy = Closure.DELEGATE_FIRST
    body.delegate = config
    body()

    <span style="color:#777">// now build, based on the configuration provided</span>
    node {
        git <span style="color:#606">url</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">https://github.com/jenkinsci/</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">${</span>config.name<span style="font-weight:bold;color:#666">}</span></span><span style="color:#D20">-plugin.git</span><span style="color:#710">&quot;</span></span>
        sh <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">mvn install</span><span style="color:#710">&quot;</span></span>
        mail <span style="color:#606">to</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">...</span><span style="color:#710">&quot;</span></span>, <span style="color:#606">subject</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">${</span>config.name<span style="font-weight:bold;color:#666">}</span></span><span style="color:#D20"> plugin build</span><span style="color:#710">&quot;</span></span>, <span style="color:#606">body</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">...</span><span style="color:#710">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Assuming the script has either been loaded as a
<a href="#global-shared-libraries">Global Shared Library</a> or as a
<a href="#folder-level-shared-libraries">Folder-level Shared Library</a>
the resulting <code>Jenkinsfile</code> will be dramatically simpler:</p>
</div>
<div class="pipeline-block">  <div class="listingblock pipeline-script"
        style="display: true">
    <div class="title">Jenkinsfile (Pipeline Script)</div>
    <div class="content">
  <pre class="CodeRay highlight nowrap"><code class="language-groovy" data-lang="groovy">jenkinsPlugin {
    name = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">git</span><span style="color:#710">'</span></span>
}</code></pre>
</div></div></div>
</div>
<div class="sect2">
<h3 id="using-third-party-libraries"><a class="anchor" href="#using-third-party-libraries"></a>Using third-party libraries</h3>
<div class="paragraph">
<p>It is possible to use third-party Java libraries, typically found in
<a href="http://search.maven.org/">Maven Central</a>,
from <strong>trusted</strong> library code using the <code>@Grab</code> annotation.  Refer to the
<a href="http://docs.groovy-lang.org/latest/html/documentation/grape.html#_quick_start">Grape documentation</a>
for details, but simply put:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="groovy"><span style="color:#007">@Grab</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">org.apache.commons:commons-math3:3.4.1</span><span style="color:#710">'</span></span>)
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.apache.commons.math3.primes.Primes</span>
<span style="color:#339;font-weight:bold">void</span> parallelize(<span style="color:#339;font-weight:bold">int</span> count) {
  <span style="color:#080;font-weight:bold">if</span> (!Primes.isPrime(count)) {
    error <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">${</span>count<span style="font-weight:bold;color:#666">}</span></span><span style="color:#D20"> was not prime</span><span style="color:#710">&quot;</span></span>
  }
  <span style="color:#777">// …</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Third-party libraries are cached by default in <code>~/.groovy/grapes/</code> on the
Jenkins master.</p>
</div>
</div>
<div class="sect2">
<h3 id="loading-resources"><a class="anchor" href="#loading-resources"></a>Loading resources</h3>
<div class="paragraph">
<p>External libraries may load adjunct files from a <code>resources/</code> directory using
the <code>libraryResource</code> step.  The argument is a relative pathname, akin to Java
resource loading:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> request = libraryResource <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">com/mycorp/pipeline/somelib/request.json</span><span style="color:#710">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The file is loaded as a string, suitable for passing to certain APIs or saving
to a workspace using <code>writeFile</code>.</p>
</div>
<div class="paragraph">
<p>It is advisable to use an unique package structure so you do not accidentally
conflict with another library.</p>
</div>
</div>
<div class="sect2">
<h3 id="pretesting-library-changes"><a class="anchor" href="#pretesting-library-changes"></a>Pretesting library changes</h3>
<div class="paragraph">
<p>If you notice a mistake in a build using an untrusted library,
simply click the <em>Replay</em> link to try editing one or more of its source files,
and see if the resulting build behaves as expected.
Once you are satisfied with the result, follow the diff link from the build’s status page,
and apply the diff to the library repository and commit.</p>
</div>
<div class="paragraph">
<p>(Even if the version requested for the library was a branch, rather than a fixed version like a tag,
replayed builds will use the exact same revision as the original build:
library sources will not be checked out again.)</p>
</div>
<div class="paragraph">
<p><em>Replay</em> is not currently supported for trusted libraries.
Modifying resource files is also not currently supported during <em>Replay</em>.</p>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnote_1">
<a href="#_footnoteref_1">1</a>. <a href="http://en.wikipedia.org/wiki/Don't_repeat_yourself" class="bare">en.wikipedia.org/wiki/Don't_repeat_yourself</a>
</div>
</div>
</div>
<div class="section_nav pagination-links">
<a class="prev page-link" href="../multibranch">
⇐ Multibranch Pipelines
</a>
<a class="up page-link" href="../">
⇑ "Pipeline
</a>
<br>
<a class="index page-link" href="../../">
Index
</a>
</div>
</div>
</div>


<footer id="footer">
<div class="container">
<div class="row">
<div class="links col-lg-8 col-md-12 col-sm-12">
<ul class="major-areas">
<li class="area solo col-md-3 col-sm-6 col-xs-6">
<div class="div-mar">
<h5>Resources</h5>
<ul class="resources">
<li>
<a href="/content/event-calendar">
Events
</a>
</li>
<li>
<a href="/doc">
Documentation
</a>
</li>
<li>
<a href="/node">
Blog
</a>
</li>
</ul>
</div>
</li>
<li class="area multi col-md-3 col-sm-6 col-xs-6">
<div class="div-mar">
<h5>Solutions</h5>
<ul>
<li>
<a href="/solutions/android">
Android
</a>
</li>
<li>
<a href="/solutions/c">
C/C++
</a>
</li>
<li>
<a href="/solutions/docker">
Docker
</a>
</li>
<li>
<a href="/solutions/embedded">
Embedded
</a>
</li>
<li>
<a href="/solutions/github">
GitHub
</a>
</li>
<li>
<a href="/solutions/java">
Java
</a>
</li>
<li>
<a href="/solutions/pipeline">
Continuous Delivery
</a>
</li>
<li>
<a href="/solutions/python">
Python
</a>
</li>
<li>
<a href="/solutions/ruby">
Ruby
</a>
</li>
</ul>
</div>
</li>
<li class="area multi col-md-3 col-sm-6 col-xs-6">
<div class="div-mar">
<h5>Project</h5>
<ul class="project">
<li>
<a href="https://issues.jenkins-ci.org">
Issue tracker
</a>
</li>
<li>
<a href="https://wiki.jenkins-ci.org">
Wiki
</a>
</li>
<li>
<a href="https://github.com/jenkinsci">
GitHub
</a>
</li>
<li>
<a href="https://ci.jenkins.io">
Jenkins on Jenkins
</a>
</li>
</ul>
</div>
</li>
<li class="area multi col-md-3 col-sm-6 col-xs-6">
<div class="div-mar">
<h5>Community</h5>
<ul class="community">
<li>
<a href="https://groups.google.com/forum/#!forum/jenkinsci-users">
Users mailing list
</a>
</li>
<li>
<a href="https://groups.google.com/forum/#!forum/jenkinsci-dev">
Developers mailing list
</a>
</li>
<li>
<a href="https://twitter.com/jenkinsci">
Twitter
</a>
</li>
<li>
<a href="https://reddit.com/r/jenkinsci">
Reddit
</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="col-lg-4 col-md-12 col-sm-12 col-xs-12 footer-left">
<p class="box">
<a href="https://github.com/jenkins-infra/jenkins.io/edit/master/content//doc/book/pipeline/shared-libraries.adoc" title="Edit /doc/book/pipeline/shared-libraries.adoc on GitHub">
Improve this page
</a>
|
<a href="https://github.com/jenkins-infra/jenkins.io/commits/master/content//doc/book/pipeline/shared-libraries.adoc" title="View /doc/book/pipeline/shared-libraries.adoc history on GitHub">
Page history
</a>
</p>
<div class="license-box">
<div id="creativecommons">
<a href="https://creativecommons.org/licenses/by-sa/4.0/">
<p>
<img src="https://licensebuttons.net/l/by-sa/4.0/88x31.png">
</p>
</a>
<p>
The content driving this site is licensed under the Creative Commons Attribution-ShareAlike 4.0 license.
</p>
</div>
</div>
</div>
</div>
</div>
</footer>
<!-- starting partial footer.html.haml -->
<script>
 (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
 
ga('create', 'UA-4216293-5', 'auto');
ga('send', 'pageview');
ga('set', 'anonymizeIp', true);

</script>

<script>
  !function(d,s,id) {
    var js, fjs=d.getElementsByTagName(s)[0];
    if (!d.getElementById(id)) {
      js = d.createElement(s);
      js.id=id;
      js.src="//platform.twitter.com/widgets.js";
      fjs.parentNode.insertBefore(js,fjs);
    }
  }(document,"script","twitter-wjs");
</script>

<!-- ending partial footer.html.haml -->
</body>
</html>
